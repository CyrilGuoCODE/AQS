# 家长与老师预约系统 (AQS - Appointment Queue System)

## 项目简介

这是一个家长与老师预约系统，用于学校家长会期间的预约管理。系统支持家长在线预约老师，老师可以管理自己的预约队列和设置。

## 功能特性

- 家长和老师的登录认证系统
- 家长可以预约最多3位老师
- 老师可以设置自己的预约参数（最大预约人数、保留学生等）
- 实时队列管理和状态更新
- 导出预约列表为Excel功能
- 响应式设计，支持多设备访问
- 高性能缓存系统，提高并发处理能力

## 技术栈

- 后端：Flask + SocketIO + MongoDB
- 前端：HTML5 + CSS3 + JavaScript
- 数据处理：Pandas + OpenPyXL
- 性能优化：Redis缓存 + 线程安全缓存管理

## 系统要求

- Python 3.8+
- MongoDB 4.4+
- Redis 6.0+ (可选，用于缓存和会话存储)

## 安装部署

### 1. 克隆项目

```bash
git clone [项目地址]
cd AQS
```

### 2. 安装依赖

```bash
pip install -r requirements_optimized.txt
```

### 3. 配置环境

1. 确保MongoDB和Redis服务已启动
2. 根据需要修改配置文件中的连接信息
3. 配置正确的密钥（家长密钥和教师密钥）

### 4. 运行应用

开发环境：
```bash
python main_app.py
```

生产环境：
```bash
gunicorn -w 4 -b 0.0.0.0:5001 main_app:app
```

## 性能优化说明

本版本进行了以下性能优化：

1. **缓存系统**：
   - 实现了线程安全的缓存管理器
   - 缓存教师设置、家长数据和教师数据，减少数据库访问
   - 实现缓存失效机制，确保数据一致性

2. **数据库优化**：
   - 添加数据库索引提高查询性能
   - 批量处理数据初始化，减少数据库查询次数
   - 封装数据库操作为辅助函数，减少代码重复

3. **错误处理增强**：
   - 添加全面的异常处理
   - 实现日志系统，记录重要操作和错误信息
   - 添加用户友好的错误提示

4. **数据一致性**：
   - 修复teacher.json和teacher_2.json中的重复ID问题
   - 使用ID映射替代直接索引，提高代码健壮性

5. **代码结构优化**：
   - 添加装饰器简化权限检查
   - 将功能模块化，提高代码可维护性
   - 添加详细的函数文档，提高代码可读性

## 故障排除

1. **数据库连接问题**：检查MongoDB服务是否正常运行，连接信息是否正确
2. **缓存问题：** 如果使用Redis，确保Redis服务已启动且连接正常
3. **性能问题：** 检查日志文件中的错误和警告，根据需要调整缓存策略

## 贡献指南

欢迎提交问题报告和功能请求。如果您想贡献代码，请：

1. Fork本项目
2. 创建您的特性分支
3. 提交您的更改
4. 推送到分支
5. 创建一个Pull Request

## 许可证

[许可证类型]
